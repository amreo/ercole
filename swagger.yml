openapi: 3.0.2
info:
  title: API Ercole 2.0
  version: 1.0.0
  license:
    name: GNU General Public License v3.0 or later
    url: "https://www.gnu.org/licenses/gpl-3.0-standalone.html"
  description: API used to talk to ercole services
  contact:
    name: Issues support
    url: "https://github.com/amreo/ercole-services"
servers:
  - description: SwaggerHub API Auto Mocking
    url: "https://virtserver.swaggerhub.com/amreo/ercole/1.0.0"
tags:
  - name: data-service
    description: API served by data-service
  - name: alert-service
    description: API served by alert-service
  - name: api-service
    description: API served by api-service
  - name: fe-user
    description: API used by the end user
  - name: agent-user
    description: API used by the ercole-agent
  - name: developer-user
    description: API used by the developers
  - name: service-user
    description: API used by the services
  - name: read
    description: "API that don't change the state of the informations"
  - name: write
    description: API that change the state of the informations
components:
  securitySchemes:
    basicAuthDataService:
      type: http
      scheme: basic
      description: access to data-service APIs
    basicAuthAlertService:
      type: http
      scheme: basic
      description: access to alert-service APIs
    basicAuthApiService:
      type: http
      scheme: basic
      description: access to api-service APIs
    tokenAuthApiService:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: access using the access token
  responses:
    error:
      description: Contains some informations about a error
      content:
        application/json:
          schema:
            type: object
            additionalProperties: false
            required:
              - Error
              - ErrorDescription
              - SourceFilename
              - LineNumber
            properties:
              Error:
                type: string
              ErrorDescription:
                type: string
              SourceFilename:
                type: string
              LineNumber:
                type: integer
          examples:
            Test1:
              value:
                Error: Invalid  status
                ErrorDescription: invalid status
                SourceFilename: /home/travis/go/src/github.com/amreo/ercole-services/api-service/controller/alerts_api.go
                LineNumber: 65
  schemas:
    HostDataInfo:
      type: object
      required:
        - Hostname
        - Environment
        - Location
        - CPUModel
        - CPUCores
        - CPUThreads
        - Socket
        - Type
        - Virtual
        - Kernel
        - OS
        - MemoryTotal
        - SwapTotal
        - OracleCluster
        - VeritasCluster
        - SunCluster
        - AixCluster
      properties:
        Hostname:
          type: string
          pattern: "^(([a-zA-Z0-9]|[a-zA-Z0-9][a-zA-Z0-9\\-]*[a-zA-Z0-9])\\.)*([A-Za-z0-9]|[A-Za-z0-9][A-Za-z0-9\\-]*[A-Za-z0-9])$"
        Environment:
          type: string
        Location:
          type: string
        CPUModel:
          type: string
        CPUCores:
          type: integer
        CPUThreads:
          type: integer
        Socket:
          type: integer
        Type:
          type: string
        Virtual:
          type: boolean
        Kernel:
          type: string
        OS:
          type: string
        MemoryTotal:
          type: number
        SwapTotal:
          type: number
        OracleCluster:
          type: boolean
        VeritasCluster:
          type: boolean
        SunCluster:
          type: boolean
        AixCluster:
          type: boolean
    Filesystems:
      type: array
      items:
        type: object
        properties:
          Filesystem:
            type: string
          FsType:
            type: string
          Size:
            type: string
          Used:
            type: string
          UsedPerc:
            type: string
          MountedOn:
            type: string
        required:
          - Filesystem
          - FsType
          - Size
          - Used
          - UsedPerc
          - MountedOn
    Patch:
      type: object
      properties:
        Database:
          type: string
        Version:
          type: string
        PatchID:
          type: string
        Action:
          type: string
        Description:
          type: string
        Date:
          type: string
      required:
        - Database
        - Version
        - PatchID
        - Action
        - Description
        - Date
    Tablespace:
      type: object
      properties:
        Database:
          type: string
        Name:
          type: string
        MaxSize:
          type: string
        Total:
          type: string
        Used:
          type: string
        UsedPerc:
          type: string
        Status:
          type: string
      required:
        - Database
        - Name
        - MaxSize
        - Total
        - Used
        - UsedPerc
        - Status
    Schema:
      type: object
      properties:
        Database:
          type: string
        User:
          type: string
        Total:
          type: integer
        Tables:
          type: integer
        Indexes:
          type: integer
        LOB:
          type: integer
      required:
        - Database
        - User
        - Total
        - Tables
        - Indexes
        - LOB
    Feature:
      type: object
      properties:
        Name:
          type: string
        Status:
          type: boolean
      required:
        - Name
        - Status
    License:
      type: object
      properties:
        Name:
          type: string
        Count:
          type: number
      required:
        - Name
        - Count
    ADDM:
      type: object
      properties:
        Finding:
          type: string
        Recommendation:
          type: string
        Action:
          type: string
        Benefit:
          oneOf:
            - type: string
            - type: boolean
        Hostname:
          type: string
          nullable: true
        Location:
          type: string
          nullable: true
        Environment:
          type: string
          nullable: true
        CreatedAt:
          type: string
          nullable: true
      required:
        - Finding
        - Recommendation
        - Action
        - Benefit
    SegmentAdvisor:
      type: object
      properties:
        SegmentOwner:
          type: string
        SegmentName:
          type: string
        SegmentType:
          type: string
        PartitionName:
          type: string
        Reclaimable:
          type: string
        Recommendation:
          type: string
      required:
        - SegmentOwner
        - SegmentName
        - SegmentType
        - PartitionName
        - Reclaimable
        - Recommendation
    LastPSU:
      type: object
      properties:
        Date:
          type: string
        Description:
          type: string
      required:
        - Date
        - Description
    Backup:
      type: object
      properties:
        BackupType:
          type: string
        Hour:
          type: string
        WeekDays:
          type: string
        AvgBckSize:
          type: string
        Retention:
          type: string
      required:
        - BackupType
        - Hour
        - WeekDays
        - AvgBckSize
        - Retention
    Database:
      type: object
      properties:
        InstanceNumber:
          type: string
          nullable: true
        Name:
          type: string
        UniqueName:
          type: string
        Status:
          type: string
        Version:
          type: string
        Platform:
          type: string
          nullable: true
        Archivelog:
          type: string
          nullable: true
        Charset:
          type: string
          nullable: true
        NCharset:
          type: string
          nullable: true
        BlockSize:
          type: string
        CPUCount:
          type: string
        SGATarget:
          type: string
          nullable: true
        PGATarget:
          type: string
          nullable: true
        MemoryTarget:
          type: string
          nullable: true
        SGAMaxSize:
          type: string
          nullable: true
        SegmentsSize:
          type: string
        Used:
          type: string
          nullable: true
        Allocated:
          type: string
          nullable: true
        Elapsed:
          type: string
          nullable: true
        DBTime:
          type: string
          nullable: true
        DailyCPUUsage:
          type: string
          nullable: true
        Work:
          type: string
        ASM:
          type: boolean
          nullable: true
        Dataguard:
          type: boolean
        RAC:
          nullable: true
          type: boolean
        HA:
          nullable: true
          type: boolean
        Hostname:
          type: string
          nullable: true
        Location:
          type: string
          nullable: true
        Environment:
          type: string
          nullable: true
        CreatedAt:
          type: string
          nullable: true
        ArchiveLogStatus:
          type: boolean
          nullable: true
        Memory:
          type: number
          nullable: true
        DatafileSize:
          type: number
          nullable: true
        Patches:
          type: array
          nullable: true
          items:
            $ref: "#/components/schemas/Patch"
        Tablespaces:
          type: array
          nullable: true
          items:
            $ref: "#/components/schemas/Tablespace"
        Schemas:
          type: array
          nullable: true
          items:
            $ref: "#/components/schemas/Tablespace"
        Features:
          type: array
          nullable: true
          items:
            $ref: "#/components/schemas/Feature"
        Licenses:
          type: array
          nullable: true
          items:
            $ref: "#/components/schemas/License"
        ADDMs:
          type: array
          nullable: true
          items:
            $ref: "#/components/schemas/ADDM"
        SegmentAdvisors:
          type: array
          nullable: true
          items:
            $ref: "#/components/schemas/SegmentAdvisor"
        LastPSUs:
          type: array
          nullable: true
          items:
            $ref: "#/components/schemas/LastPSU"
        Backups:
          type: array
          nullable: true
          items:
            $ref: "#/components/schemas/Backup"
        Changes:
          nullable: true
          type: array
          items:
            $ref: "#/components/schemas/DatabaseChange"
      required:
        - Name
        - UniqueName
        - Status
        - Version
        - BlockSize
        - CPUCount
        - SegmentsSize
        - Work
        - Dataguard
    Cluster:
      type: object
      properties:
        Name:
          type: string
        Type:
          type: string
        CPU:
          type: integer
        Sockets:
          type: integer
        VMs:
          type: array
          items:
            type: object
            properties:
              Name:
                type: string
              ClusterName:
                type: string
              Hostname:
                type: string
              CappedCPU:
                type: boolean
              PhysicalHost:
                type: string
            required:
              - Name
              - ClusterName
              - Hostname
              - CappedCPU
              - PhysicalHost
      required:
        - Name
        - Type
        - CPU
        - Sockets
        - VMs
    CellDisk:
      type: object
      properties:
        Name:
          type: string
        Status:
          type: string
        ErrCount:
          type: string
        UsedPerc:
          type: string
      required:
        - Name
        - Status
        - ErrCount
        - UsedPerc
    ExadataDev:
      type: object
      properties:
        Hostname:
          type: string
        ServerType:
          type: string
        Model:
          type: string
        ExaSwVersion:
          type: string
        CPUEnabled:
          type: string
        Memory:
          type: string
        Status:
          type: string
        PowerCount:
          type: string
        PowerStatus:
          type: string
        FanCount:
          type: string
        FanStatus:
          type: string
        TempActual:
          type: string
        TempStatus:
          type: string
        CellsrvService:
          type: string
        MsService:
          type: string
        RsService:
          type: string
        FlashcacheMode:
          type: string
        CellDisks:
          nullable: true
          type: array
          items:
            $ref: "#/components/schemas/CellDisk"
      required:
        - Hostname
        - ServerType
        - Model
        - ExaSwVersion
        - CPUEnabled
        - Memory
        - Status
        - PowerCount
        - PowerStatus
        - FanCount
        - FanStatus
        - TempActual
        - TempStatus
        - CellsrvService
        - MsService
        - RsService
        - FlashcacheMode
        - CellDisks
    HostData:
      description: A hostdata from FE
      type: object
      properties:
        Hostname:
          type: string
        Environment:
          type: string
        Location:
          type: string
        HostType:
          enum:
            - oracledb
            - virtualization
            - exadata
        Version:
          type: string
        HostDataSchemaVersion:
          type: integer
        Databases:
          type: string
        Schemas:
          type: string
          nullable: true
        Info:
          $ref: "#/components/schemas/HostDataInfo"
        OS:
          type: string
          nullable: true
        Kernel:
          type: string
          nullable: true
        OracleCluster:
          type: boolean
          nullable: true
        SunCluster:
          type: boolean
          nullable: true
        VeritasCluster:
          type: boolean
          nullable: true
        Virtual:
          type: boolean
          nullable: true
        Type:
          type: string
          nullable: true
        CPUThreads:
          type: integer
          nullable: true
        CPUCores:
          type: integer
          nullable: true
        Socket:
          type: integer
          nullable: true
        MemTotal:
          type: integer
          nullable: true
        SwapTotal:
          type: integer
          nullable: true
        CPUModel:
          type: string
          nullable: true
        PhysicalServerName:
          type: string
          nullable: true
        VirtualServerName:
          type: string
          nullable: true
        VirtualizationTechnology:
          type: string
          nullable: true
        DBInstanceName:
          type: string
          nullable: true
        PluggableDatabaseName:
          type: string
          nullable: true
        ConnectString:
          type: string
          nullable: true
        ProductVersion:
          type: string
          nullable: true
        ProductEdition:
          type: string
          nullable: true
        Features:
          type: string
          nullable: true
        RacNodeNames:
          type: string
          nullable: true
        ProcessorModel:
          type: string
          nullable: true
        Processors:
          type: integer
          nullable: true
        CoresPerProcessor:
          type: integer
          nullable: true
        ThreadsPerCore:
          type: integer
          nullable: true
        ProcessorSpeed:
          type: string
          nullable: true
        ServerPurchaseDate:
          type: string
          nullable: true
        OperatingSystem:
          type: string
          nullable: true
        Notes:
          type: string
          nullable: true
        PhysicalCores:
          type: integer
          nullable: true
        History:
          type: array
          items:
            $ref: "#/components/schemas/HistoryEntry"
        Extra:
          type: object
          required:
            - Filesystems
          properties:
            Filesystems:
              $ref: "#/components/schemas/Filesystems"
            Databases:
              nullable: true
              type: array
              items:
                $ref: "#/components/schemas/Database"
            Clusters:
              nullable: true
              type: array
              items:
                $ref: "#/components/schemas/Cluster"
            Exadata:
              nullable: true
              type: object
              properties:
                Devices:
                  type: array
                  items:
                    $ref: "#/components/schemas/ExadataDev"
              required:
                - Devices
        Cluster:
          type: string
          nullable: true
        PhysicalHost:
          type: string
          nullable: true
      required:
        - Hostname
        - Environment
        - Location
        - Version
        - HostDataSchemaVersion
        - Info
        - Extra
    PageMetadata:
      type: object
      required:
        - Empty
        - First
        - Last
        - Number
        - Size
        - TotalElements
        - TotalPages
      properties:
        Empty:
          type: boolean
        First:
          type: boolean
        Last:
          type: boolean
        Number:
          type: integer
        Size:
          type: integer
        TotalElements:
          type: integer
        TotalPages:
          type: integer
    HistoryEntry:
      type: object
      required:
        - _id
        - CreatedAt
      properties:
        _id:
          type: string
        CreatedAt:
          type: string
    DatabaseChange:
      type: object
      required:
        - DailyCPUUsage
        - SegmentsSize
        - Updated
        - Used
      properties:
        DailyCPUUsage:
          type: string
        SegmentsSize:
          type: string
        Updated:
          type: string
        Used:
          type: string
    PatchingFunction:
      type: object
      required:
        - Code
        - Vars
      properties:
        ID:
          type: string
          nullable: true
        Hostname:
          type: string
          nullable: true
        CreatedAt:
          type: string
          nullable: true
        Code:
          type: string
        Vars:
          type: object
    Alert:
      title: Alert
      type: object
      x-examples:
        example-1:
          AlertCode: NEW_DATABASE
          AlertSeverity: NOTICE
          AlertStatus: NEW
          Date: "2020-04-15T14:28:04.309+02:00"
          Description: "The database 'ERCOLE' was created on the server itl-csllab-112.sorint.localpippo"
          Hostname: itl-csllab-112.sorint.localpippo
          OtherInfo:
            Dbname: ERCOLE
            Hostname: itl-csllab-112.sorint.localpippo
          _id: 5e96fdd41a65b0bf4e980292
      properties:
        OtherInfo:
          type: object
          properties:
            DbName:
              type: string
            Hostname:
              type: string
        Hostname:
          type: string
        Description:
          type: string
        AlertStatus:
          type: string
          enum:
            - NEW
            - ACK
          example: NEW
        AlertSeverity:
          type: string
          enum:
            - MINOR
            - WARNING
            - MAJOR
            - CRITICAL
            - NOTICE
          example: MAJOR
        AlertCode:
          type: string
        _id:
          type: string
          description: ID of the alert
      required:
        - Hostname
        - Description
        - AlertStatus
        - AlertSeverity
        - AlertCode
        - _id
  parameters:
    search:
      in: query
      name: search
      required: false
      description: filter the result using search terms
      allowEmptyValue: true
      example: foobar
      schema:
        type: string
        readOnly: true
        example: foobar
    sort-by:
      in: query
      name: sort-by
      required: false
      description: sort the result by a field
      allowEmptyValue: true
      example: foobar
      schema:
        type: string
        readOnly: true
        example: CreatedAt
    sort-desc:
      schema:
        type: boolean
      in: query
      name: sort-desc
      description: |
        Sort the field descendently instead of ascendently
      allowEmptyValue: true
    page:
      schema:
        type: integer
      in: query
      name: page
      description: Number of the page
      allowEmptyValue: true
    size:
      schema:
        type: integer
      in: query
      name: size
      description: Size of the page
      allowEmptyValue: true
    location:
      schema:
        type: string
        example: Italy
      in: query
      name: location
      description: Filter by location
      allowEmptyValue: true
    environment:
      schema:
        type: string
        example: TST
      in: query
      name: environment
      description: Filter by environment
      allowEmptyValue: true
    older-than:
      schema:
        type: string
        format: date-time
        example: "2020-05-05T08:23:40+00:00"
      in: query
      name: older-than
      description: Filter until the date
      allowEmptyValue: true
#########################################################################
### PATHS
#########################################################################
paths:
  /ping:
    get:
      summary: Check the availability of the server
      description: Check the availability of the server
      tags:
        - data-service
        - api-service
        - alert-service
        - developer-user
        - read
      operationId: ping
      responses:
        "200":
          description: OK
          content:
            text/plain:
              schema:
                type: string
                example: "PONG!"
                readOnly: true
  "/queue/host-data-insertion/{id}":
    post:
      tags:
        - alert-service
        - service-user
        - write
      security:
        - basicAuthAlertService: []
      summary: Enqueue a host data insertion event
      description: Add a host data insertion event to the queue
      operationId: hostDataInsertion
      parameters:
        - in: path
          name: id
          description: ID of the inserted hostdata
          required: true
          schema:
            type: string
            minLength: 24
            maxLength: 24
            pattern: "^[0-9a-fA-F]+$"
            example: 5e3a95f6d76af99696203d4a
      responses:
        "200":
          description: OK
        "401":
          $ref: "#/components/responses/error"
        "422":
          $ref: "#/components/responses/error"
        "500":
          $ref: "#/components/responses/error"
  /user/login:
    post:
      tags:
        - api-service
        - fe-user
      security: []
      summary: Request access token
      description: Request a user access token given the credentials. Note that the behaviour and interface may change if the service is configured to use different authentication provider.
      operationId: GetToken
      responses:
        "200":
          description: Access token
          content:
            text/plain:
              schema:
                type: string
                readOnly: true
                example: eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9.eyJhdWQiOlsidXNlciJdLCJleHAiOjE1ODg2NjExMjMsImlhdCI6MTU4ODY2MDIyMywiaXNzIjoiZXJjb2xlIiwianRpIjoidXNlciIsIm5iZiI6MTU4ODY2MDIyMywic3ViIjoidXNlciJ9.QJhUuBR4Z8uPncXITUjRVHktZXLVax1wstMMd4x6qSDPmxGbYTfOINUawgNNSV9ho-C0rh3icks3Q3227fiyUEcdV0Tfa2O5t7lJX0A4MdTnd2sVv_xxlMju8lCBGnf82fvtSg3C0rQsWnmxgC1rBDW3lzru0ffIJG_JrV3mNxhigniBzm_C0Gq1AaL2cmZ0POCnYJReYcLY-9maKRhMsjcart8pqGZ-5jEjMNWxSc7Lh2snCZklFE0NrmtxvaWITSjm4JGWvTwZcWIfTNBiZRABr5OKARVPMsdgOZ--a4kjIsdXngtIX-C5iaISrgRAUv89XInNBvrquqXnq7p5vg
                description: JWT access token
        "401":
          $ref: "#/components/responses/error"
        "422":
          $ref: "#/components/responses/error"
        "500":
          $ref: "#/components/responses/error"
  /hosts:
    get:
      tags:
        - api-service
        - fe-user
      operationId: SearchHosts
      summary: Search a list of hosts
      description: Get a list of hosts filtered using various search terms and various params. Can also generate a XLSX file
      parameters:
        - in: query
          name: mode
          description: change the scheme of the output
          allowEmptyValue: true
          example: full
          schema:
            type: string
            readOnly: true
            enum:
              - full
              - summary
              - lms
              - mhd
        - $ref: "#/components/parameters/search"
        - $ref: "#/components/parameters/sort-by"
        - $ref: "#/components/parameters/sort-desc"
        - $ref: "#/components/parameters/page"
        - $ref: "#/components/parameters/size"
        - $ref: "#/components/parameters/location"
        - $ref: "#/components/parameters/environment"
        - $ref: "#/components/parameters/older-than"
      responses:
        "200":
          description: Result of the search
          content:
            application/json:
              schema:
                oneOf:
                  - type: object
                    description: full paged
                    properties:
                      Content:
                        type: array
                        items:
                          $ref: "#/components/schemas/HostData"
                      Metadata:
                        $ref: "#/components/schemas/PageMetadata"
                    required:
                      - Content
                      - Metadata
                  - type: array
                    description: full non paged
                    items:
                      $ref: "#/components/schemas/HostData"
                  - type: object
                    description: summary paged
                    properties:
                      Content:
                        type: array
                        items:
                          $ref: "#/components/schemas/HostData"
                      Metadata:
                        $ref: "#/components/schemas/PageMetadata"
                    required:
                      - Content
                      - Metadata
                  - type: array
                    description: summary non paged
                    items:
                      $ref: "#/components/schemas/HostData"
                  - type: object
                    description: lms paged
                    properties:
                      Content:
                        type: array
                        items:
                          $ref: "#/components/schemas/HostData"
                      Metadata:
                        $ref: "#/components/schemas/PageMetadata"
                    required:
                      - Content
                      - Metadata
                  - type: array
                    description: lms non paged
                    items:
                      $ref: "#/components/schemas/HostData"
            ? application/vnd.oracle.lms+vnd.openxmlformats-officedocument.spreadsheetml.sheet
            : {}
            application/vnd.openxmlformats-officedocument.spreadsheetml.sheet:
              {}
        "401":
          $ref: "#/components/responses/error"
        "422":
          $ref: "#/components/responses/error"
        "500":
          $ref: "#/components/responses/error"
  "/hosts/{hostname}":
    parameters:
      - in: path
        name: hostname
        schema:
          type: string
        required: true
        description: hostname of the requested host
    get:
      tags:
        - api-service
        - fe-user
        - read
      operationId: GetHost
      summary: Get a host
      description: Get a host
      parameters:
        - $ref: "#/components/parameters/older-than"
      responses:
        "200":
          description: Result of the search
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/HostData"
    delete:
      tags:
        - api-service
        - fe-user
        - write
      operationId: ArchiveHost
      summary: Archive a host
      description: Archive a host
      responses:
        "200":
          description: The host is archived
          content: {}
        "401":
          $ref: "#/components/responses/error"
        "404":
          description: The host is not found
          $ref: "#/components/responses/error"
        "422":
          $ref: "#/components/responses/error"
        "500":
          $ref: "#/components/responses/error"
  "/hosts/{hostname}/patching-function":
    parameters:
      - in: path
        name: hostname
        schema:
          type: string
        required: true
        description: hostname of the requested host
    get:
      tags:
        - api-service
        - developer-user
        - read
      operationId: GetPatchingFunction
      summary: Get a patching function of a host
      description: Get a patching function of a host
      responses:
        "200":
          description: Patching function of the host
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/PatchingFunction"
        "401":
          $ref: "#/components/responses/error"
        "404":
          description: 'The host or patching function don"t exist'
          $ref: "#/components/responses/error"
        "422":
          $ref: "#/components/responses/error"
        "500":
          $ref: "#/components/responses/error"
    put:
      tags:
        - api-service
        - developer-user
        - write
      operationId: SetPatchingFunction
      summary: Set a patching function of a host
      description: Set the patching function of a host
      responses:
        "200":
          description: Patching function of the host
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/PatchingFunction"
        "401":
          $ref: "#/components/responses/error"
        "404":
          description: 'The host don"t exist'
          $ref: "#/components/responses/error"
        "422":
          $ref: "#/components/responses/error"
        "500":
          $ref: "#/components/responses/error"
  "/hosts/{hostname}/databases/{dbname}/tags":
    parameters:
      - in: path
        name: hostname
        schema:
          type: string
        required: true
        description: hostname of the requested host
      - in: path
        name: dbname
        schema:
          type: string
        required: true
        description: name of the modifying database
    post:
      tags:
        - api-service
        - fe-user
        - write
      operationId: AddTagToDatabase
      summary: Add a tag to a database of a host
      description: Add a tag to a database of a host
      requestBody:
        required: true
        content:
          text/plain:
            schema:
              type: string
      responses:
        "200":
          description: The tag was successfully attached to the db
          content:
            application/json: {}
        "401":
          $ref: "#/components/responses/error"
        "422":
          $ref: "#/components/responses/error"
        "500":
          $ref: "#/components/responses/error"
  "/hosts/{hostname}/databases/{dbname}/tags/{tagname}":
    parameters:
      - in: path
        name: hostname
        schema:
          type: string
        required: true
        description: hostname of the requested host
      - in: path
        name: dbname
        schema:
          type: string
        required: true
        description: name of the modifying database
      - in: path
        name: tagname
        schema:
          type: string
        required: true
        description: name of the tag
    delete:
      tags:
        - api-service
        - fe-user
        - write
      operationId: DeleteTagOfDatabase
      summary: Delete a tag of a database of a host
      description: Add a tag of a database of a host
      responses:
        "200":
          description: The tag was successfully deleted from the db
          content:
            application/json: {}
        "401":
          $ref: "#/components/responses/error"
        "422":
          $ref: "#/components/responses/error"
        "500":
          $ref: "#/components/responses/error"
  "/hosts/{hostname}/databases/{dbname}/licenses/{licenseName}":
    parameters:
      - in: path
        name: hostname
        schema:
          type: string
        required: true
        description: hostname of the requested host
      - in: path
        name: dbname
        schema:
          type: string
        required: true
        description: name of the modifying database
      - in: path
        name: licenseName
        schema:
          type: string
        required: true
        description: name of the license
    put:
      tags:
        - api-service
        - fe-user
        - write
      operationId: SetLicenseModifier
      summary: Change the value of a license of a database
      description: Change the value of a license of a database
      requestBody:
        content:
          text/plain:
            schema:
              type: number
      responses:
        "200":
          description: The value of the the license was changed successfully
          content:
            application/json: {}
        "401":
          $ref: "#/components/responses/error"
        "422":
          $ref: "#/components/responses/error"
        "500":
          $ref: "#/components/responses/error"
  "/hosts/{hostname}/databases/{dbname}/license-modifiers/{licenseName}":
    parameters:
      - in: path
        name: hostname
        schema:
          type: string
        required: true
        description: hostname of the requested host
      - in: path
        name: dbname
        schema:
          type: string
        required: true
        description: name of the modifying database
      - in: path
        name: licenseName
        schema:
          type: string
        required: true
        description: name of the license
    delete:
      tags:
        - api-service
        - fe-user
        - write
      operationId: DeleteLicenseModifier
      summary: Delete a license modifier of a database
      description: Delete a license modifier of a database
      responses:
        "200":
          description: The license modifier was deleted successfully
          content:
            application/json: {}
        "401":
          $ref: "#/components/responses/error"
        "422":
          $ref: "#/components/responses/error"
        "500":
          $ref: "#/components/responses/error"
  /databases:
    get:
      tags:
        - api-service
        - fe-user
        - read
      operationId: SearchDatabases
      summary: Search a list of databases
      description: Get a list of databases filtered using various search terms and various params. Can also generate a XLSX file
      parameters:
        - in: query
          name: full
          description: output mode
          allowEmptyValue: true
          schema:
            type: boolean
            readOnly: true
        - $ref: "#/components/parameters/search"
        - $ref: "#/components/parameters/sort-by"
        - $ref: "#/components/parameters/sort-desc"
        - $ref: "#/components/parameters/page"
        - $ref: "#/components/parameters/size"
        - $ref: "#/components/parameters/location"
        - $ref: "#/components/parameters/environment"
        - $ref: "#/components/parameters/older-than"
      responses:
        "200":
          description: Result of the search
          content:
            application/json:
              schema:
                oneOf:
                  - type: object
                    description: "full paged"
                    properties:
                      Content:
                        type: array
                        items:
                          $ref: "#/components/schemas/Database"
                      Metadata:
                        $ref: "#/components/schemas/PageMetadata"
                    required:
                      - Content
                      - Metadata
                  - type: array
                    description: "full non paged"
                    items:
                      $ref: "#/components/schemas/Database"
                  - type: object
                    description: "not full paged"
                    properties:
                      Content:
                        type: array
                        items:
                          $ref: "#/components/schemas/Database"
                      Metadata:
                        $ref: "#/components/schemas/PageMetadata"
                    required:
                      - Content
                      - Metadata
                  - type: array
                    description: "not full non paged"
                    items:
                      $ref: "#/components/schemas/Database"
            application/vnd.openxmlformats-officedocument.spreadsheetml.sheet:
              {}
        "401":
          $ref: "#/components/responses/error"
        "422":
          $ref: "#/components/responses/error"
        "500":
          $ref: "#/components/responses/error"
  /addms:
    get:
      tags:
        - api-service
        - fe-user
        - read
      operationId: SearchAddms
      summary: Search a list of ADDMs
      description: Get a list of ADDMs filtered using various search terms and various params. Can also generate a XLSX file
      parameters:
        - $ref: "#/components/parameters/search"
        - $ref: "#/components/parameters/sort-by"
        - $ref: "#/components/parameters/sort-desc"
        - $ref: "#/components/parameters/page"
        - $ref: "#/components/parameters/size"
        - $ref: "#/components/parameters/location"
        - $ref: "#/components/parameters/environment"
        - $ref: "#/components/parameters/older-than"
      responses:
        "200":
          description: Result of the search
          content:
            application/json:
              schema:
                oneOf:
                  - type: object
                    description: "paged"
                    properties:
                      Content:
                        type: array
                        items:
                          $ref: "#/components/schemas/ADDM"
                      Metadata:
                        $ref: "#/components/schemas/PageMetadata"
                    required:
                      - Content
                      - Metadata
                  - type: array
                    description: "non paged"
                    items:
                      $ref: "#/components/schemas/ADDM"
            application/vnd.openxmlformats-officedocument.spreadsheetml.sheet:
              {}
        "401":
          $ref: "#/components/responses/error"
        "422":
          $ref: "#/components/responses/error"
        "500":
          $ref: "#/components/responses/error"
  /locations:
    get:
      tags:
        - api-service
        - fe-user
        - read
      operationId: ListLocations
      summary: List the locations
      description: List the locations
      parameters:
        - $ref: "#/components/parameters/location"
        - $ref: "#/components/parameters/environment"
        - $ref: "#/components/parameters/older-than"
      responses:
        "200":
          description: List of the locations
          content:
            application/json:
              schema:
                type: array
                items:
                  type: string
                uniqueItems: true
        "401":
          $ref: "#/components/responses/error"
        "422":
          $ref: "#/components/responses/error"
        "500":
          $ref: "#/components/responses/error"
  /environments:
    get:
      tags:
        - api-service
        - fe-user
        - read
      operationId: ListEnvironments
      summary: List the environments
      description: List the environments
      parameters:
        - $ref: "#/components/parameters/location"
        - $ref: "#/components/parameters/environment"
        - $ref: "#/components/parameters/older-than"
      responses:
        "200":
          description: List of the environments
          content:
            application/json:
              schema:
                type: array
                items:
                  type: string
                uniqueItems: true
        "401":
          $ref: "#/components/responses/error"
        "422":
          $ref: "#/components/responses/error"
        "500":
          $ref: "#/components/responses/error"
  /alerts:
    get:
      summary: search alerts using the filters in the request
      description: search alerts using the filters in the request
      tags:
        - api-service
        - fe-user
      operationId: SearchAlerts
      parameters:
        - $ref: "#/components/parameters/search"
        - $ref: "#/components/parameters/sort-by"
        - $ref: "#/components/parameters/sort-desc"
        - $ref: "#/components/parameters/page"
        - $ref: "#/components/parameters/size"
        - in: query
          schema:
            type: string
            enum:
              - MINOR
              - WARNING
              - MAJOR
              - CRITICAL
              - NOTICE
          name: severity
          description: Filter by severity
          allowEmptyValue: true
        - in: query
          name: status
          required: false
          description: Filter by status
          allowEmptyValue: true
          schema:
            type: string
            readOnly: true
            enum:
              - NEW
              - ACK
            example: NEW
        - in: query
          schema:
            type: string
            format: date-time
            example: "2020-05-05T08:23:40+00:00"
          name: from
          description: Filter from a date
          allowEmptyValue: true
        - in: query
          schema:
            type: string
            format: date-time
            example: "2021-05-05T08:23:40+00:00"
          name: to
          description: Filter until a date
          allowEmptyValue: true
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                anyOf:
                  - type: array
                    items:
                      $ref: "#/components/schemas/Alert"
                  - type: object
                    properties:
                      Content:
                        type: array
                        items:
                          $ref: "#/components/schemas/Alert"
                      Metadata:
                        type: object
                        properties:
                          Empty:
                            type: boolean
                          First:
                            type: boolean
                          Last:
                            type: boolean
                          Number:
                            type: integer
                          Size:
                            type: integer
                          TotalElements:
                            type: integer
                          TotalPages:
                            type: integer
              examples:
                example with page=0 and size=3:
                  value:
                    Content:
                      - AlertCode: NEW_SERVER
                        AlertSeverity: NOTICE
                        AlertStatus: NEW
                        Date: "2020-04-15T14:27:59.858+02:00"
                        Description: "The server 'rac1_x' was added to ercole"
                        Hostname: rac1_x
                        OtherInfo:
                          Hostname: rac1_x
                        _id: 5e96fdcf1a65b0bf4e98028f
                      - AlertCode: NEW_SERVER
                        AlertSeverity: NOTICE
                        AlertStatus: NEW
                        Date: "2020-04-15T14:28:04.309+02:00"
                        Description: "The server 'itl-csllab-112.sorint.localpippo' was added to ercole"
                        Hostname: itl-csllab-112.sorint.localpippo
                        OtherInfo:
                          Hostname: itl-csllab-112.sorint.localpippo
                        _id: 5e96fdd41a65b0bf4e980291
                      - AlertCode: NEW_DATABASE
                        AlertSeverity: NOTICE
                        AlertStatus: NEW
                        Date: "2020-04-15T14:28:04.309+02:00"
                        Description: "The database 'ERCOLE' was created on the server itl-csllab-112.sorint.localpippo"
                        Hostname: itl-csllab-112.sorint.localpippo
                        OtherInfo:
                          Dbname: ERCOLE
                          Hostname: itl-csllab-112.sorint.localpippo
                        _id: 5e96fdd41a65b0bf4e980292
                    Metadata:
                      Empty: false
                      First: true
                      Last: false
                      Number: 0
                      Size: 3
                      TotalElements: 25
                      TotalPages: 8
                example without paging:
                  value:
                    - AlertCode: NEW_SERVER
                      AlertSeverity: NOTICE
                      AlertStatus: NEW
                      Date: "2020-04-15T14:27:59.858+02:00"
                      Description: "The server 'rac1_x' was added to ercole"
                      Hostname: rac1_x
                      OtherInfo:
                        Hostname: rac1_x
                      _id: 5e96fdcf1a65b0bf4e98028f
                    - AlertCode: NEW_DATABASE
                      AlertSeverity: NOTICE
                      AlertStatus: NEW
                      Date: "2020-04-15T14:28:04.309+02:00"
                      Description: "The database 'ERCOLE' was created on the server itl-csllab-112.sorint.localpippo"
                      Hostname: itl-csllab-112.sorint.localpippo
                      OtherInfo:
                        Dbname: ERCOLE
                        Hostname: itl-csllab-112.sorint.localpippo
                      _id: 5e96fdd41a65b0bf4e980292
                    - AlertCode: NEW_LICENSE
                      AlertSeverity: CRITICAL
                      AlertStatus: NEW
                      Date: "2020-04-15T14:28:04.309+02:00"
                      Description: A new Enterprise license has been enabled to itl-csllab-112.sorint.localpippo
                      Hostname: itl-csllab-112.sorint.localpippo
                      OtherInfo:
                        Hostname: itl-csllab-112.sorint.localpippo
                      _id: 5e96fdd41a65b0bf4e980293
                    - AlertCode: NEW_OPTION
                      AlertSeverity: CRITICAL
                      AlertStatus: NEW
                      Date: "2020-04-15T14:28:04.309+02:00"
                      Description: The database ERCOLE on itl-csllab-112.sorint.localpippo has enabled new features (Diagnostics Pack) on server
                      Hostname: itl-csllab-112.sorint.localpippo
                      OtherInfo:
                        Dbname: ERCOLE
                        Features:
                          - Diagnostics Pack
                        Hostname: itl-csllab-112.sorint.localpippo
                      _id: 5e96fdd41a65b0bf4e980294
                    - AlertCode: NEW_DATABASE
                      AlertSeverity: NOTICE
                      AlertStatus: NEW
                      Date: "2020-04-15T14:28:09.787+02:00"
                      Description: "The database 'urcole' was created on the server itl-csllab-112.sorint.localpippo"
                      Hostname: itl-csllab-112.sorint.localpippo
                      OtherInfo:
                        Dbname: urcole
                        Hostname: itl-csllab-112.sorint.localpippo
                      _id: 5e96fdd91a65b0bf4e980296
                    - AlertCode: NEW_LICENSE
                      AlertSeverity: CRITICAL
                      AlertStatus: NEW
                      Date: "2020-04-15T14:28:09.787+02:00"
                      Description: A new Enterprise license has been enabled to itl-csllab-112.sorint.localpippo
                      Hostname: itl-csllab-112.sorint.localpippo
                      OtherInfo:
                        Hostname: itl-csllab-112.sorint.localpippo
                      _id: 5e96fdd91a65b0bf4e980297
                    - AlertCode: NEW_OPTION
                      AlertSeverity: CRITICAL
                      AlertStatus: NEW
                      Date: "2020-04-15T14:28:09.787+02:00"
                      Description: The database urcole on itl-csllab-112.sorint.localpippo has enabled new features (Diagnostics Pack) on server
                      Hostname: itl-csllab-112.sorint.localpippo
        "401":
          $ref: "#/components/responses/error"
        "422":
          $ref: "#/components/responses/error"
        "500":
          $ref: "#/components/responses/error"
  "/alerts/{id}":
    parameters:
      - in: path
        name: id
        schema:
          type: string
        required: true
        description: alert id
    delete:
      summary: AckAlert ack the specified alert in the request
      description: AckAlert ack the specified alert in the request
      tags:
        - api-service
        - fe-user
      operationId: AckAlert
      responses:
        "200":
          description: OK
        "401":
          $ref: "#/components/responses/error"
        "403":
          description: The API is disabled because the service is put in read-only mode
        "422":
          $ref: "#/components/responses/error"
        "500":
          $ref: "#/components/responses/error"
  /clusters:
    get:
      summary: Search a list of clusters
      tags:
        - api-service
        - fe-user
      responses:
        "200":
          description: OK
          headers: {}
          content:
            application/json:
              schema:
                oneOf:
                  - type: array
                    items:
                      $ref: "#/components/schemas/Cluster"
                  - type: object
                    properties:
                      Content:
                        type: array
                        items:
                          $ref: "#/components/schemas/Cluster"
                      Metadata:
                        $ref: "#/components/schemas/PageMetadata"
              examples:
                json without paging:
                  value:
                    - CPU: 216
                      Environment: PROD
                      Hostname: fb-canvas-b9b1d8fa8328fe972b1e031621e8a6c9
                      HostnameAgentVirtualization: fb-canvas-b9b1d8fa8328fe972b1e031621e8a6c9
                      Location: Italy
                      Name: Malawi-14ae10546e26f501903775d69ca71ed6
                      PhysicalHosts: aip-f7ac72d65c3d0f28b3be0c26ef19b67e core4-946e846e3266aef1b0a5caf0853bd1e2 globe-1c7ed122094a9a20e7e4dc94db586829 hi-tech-ad02f9047e0d90b2316bfee07ce932b7 kabinet-d14b782bb1b7fd8156149d3a3979f27d kodeks-e21341c5c7820452c7448790c4ce7965 nikita-54069d32da6d7577e88feff9bbcdb5b7 sail-b5add97f3e182af4c87bd608bc967b89 srvc22-163b8c9d378f6f8895d0e156b16ca1af
                      Sockets: 18
                      Type: ovm
                      _id: 5e96fde91a65b0bf4e9802a4
                    - CPU: 24
                      Environment: PROD
                      Hostname: fb-canvas-b9b1d8fa8328fe972b1e031621e8a6c9
                      HostnameAgentVirtualization: fb-canvas-b9b1d8fa8328fe972b1e031621e8a6c9
                      Location: Italy
                      Name: Benin-0195679dbe594b14abe5c277a849f71a
                      PhysicalHosts: kernel-c3b26054af731b58a4a5dd0afc33d1a3 rad2-94ac849abaafdf1133fa71d76f365676
                      Sockets: 4
                      Type: ovm
                      _id: 5e96fde91a65b0bf4e9802a4
                    - CPU: 0
                      Environment: PROD
                      Hostname: fb-canvas-b9b1d8fa8328fe972b1e031621e8a6c9
                      HostnameAgentVirtualization: fb-canvas-b9b1d8fa8328fe972b1e031621e8a6c9
                      Location: Italy
                      Name: not_in_cluster
                      PhysicalHosts: aspera-b1fe49e8501c9ef031e5acff4b5e69a9
                      Sockets: 0
                      Type: unknown
                      _id: 5e96fde91a65b0bf4e9802a4
                    - CPU: 140
                      Environment: PROD
                      Hostname: test-virt
                      HostnameAgentVirtualization: test-virt
                      Location: Italy
                      Name: Puzzait
                      PhysicalHosts: s157-cb32c10a56c256746c337e21b3f82402
                      Sockets: 10
                      Type: vmware
                      _id: 5e96fdfb1a65b0bf4e9802a8
                json with paging of size 3:
                  value:
                    Content:
                      - CPU: 140
                        Environment: PROD
                        Hostname: fb-canvas-b9b1d8fa8328fe972b1e031621e8a6c9
                        HostnameAgentVirtualization: fb-canvas-b9b1d8fa8328fe972b1e031621e8a6c9
                        Location: Italy
                        Name: Kuwait-57b3056c82e683f48cb2bb6540c11400
                        PhysicalHosts: 120-90be671af89eaf0e30be81da23e1b84e mtm-33b6dd0ffed21137cb3d43d19cac46ad pdd-d50ecef60a81d7774731c614002d1f6f s157-cb32c10a56c256746c337e21b3f82402 wts-e4371401590b884eb8b617b484981e7f
                        Sockets: 10
                        Type: vmware
                        _id: 5e96fde91a65b0bf4e9802a4
                      - CPU: 120
                        Environment: PROD
                        Hostname: fb-canvas-b9b1d8fa8328fe972b1e031621e8a6c9
                        HostnameAgentVirtualization: fb-canvas-b9b1d8fa8328fe972b1e031621e8a6c9
                        Location: Italy
                        Name: Angola-1dac9f7418db9b52c259ce4ba087cdb6
                        PhysicalHosts: 85-fe26dd53fd3f1def9629e01cdf2a3f2f 85st-98267410e051fa5158808a97be4461d5 localmail-0a8ec10dc2e5a2eaff1e12bfda9ac2e4 masters-ce97f9677cdff85c88f230999361894d suspended-290dce22a939f3868f8f23a6e1f57dd8
                        Sockets: 10
                        Type: vmware
                        _id: 5e96fde91a65b0bf4e9802a4
                      - CPU: 36
                        Environment: PROD
                        Hostname: fb-canvas-b9b1d8fa8328fe972b1e031621e8a6c9
                        HostnameAgentVirtualization: fb-canvas-b9b1d8fa8328fe972b1e031621e8a6c9
                        Location: Italy
                        Name: Oman-8937f71ed6f3971555e15e2771db239e
                        PhysicalHosts: duma-facdfcc851a2913f903df31abce563c3 isms-9a1b83714ea7a358aa14b71b6c2405a5 tree-f96e941ab35a2bc95b1c50fc01bbf963
                        Sockets: 6
                        Type: vmware
                        _id: 5e96fde91a65b0bf4e9802a4
                    Metadata:
                      Empty: false
                      First: true
                      Last: false
                      Number: 0
                      Size: 3
                      TotalElements: 23
                      TotalPages: 7
            application/xml:
              schema:
                type: object
                properties: {}
            application/vnd.openxmlformats-officedocument.spreadsheetml.sheet:
              schema:
                type: object
                properties: {}
              examples: {}
      operationId: SearchClusters
      description: |-
        Search clusters data using the filters in the request.
        Return content type could be JSON or XLSX.
      parameters:
        - $ref: "#/components/parameters/search"
        - $ref: "#/components/parameters/sort-by"
        - $ref: "#/components/parameters/sort-desc"
        - $ref: "#/components/parameters/page"
        - $ref: "#/components/parameters/size"
        - $ref: "#/components/parameters/location"
        - $ref: "#/components/parameters/environment"
        - $ref: "#/components/parameters/older-than"
  /stats/exadata/storage-error-count-status:
    get:
      tags:
        - api-service
        - fe-user
        - read
      operationId: GetExadataStorageErrorCountStatusStats
      summary: Get the statistics about the ErrorCount status of the storage of the exadata
      description: Get the statistics about the ErrorCount status of the storage of the  exadata
      parameters:
        - $ref: "#/components/parameters/location"
        - $ref: "#/components/parameters/environment"
        - $ref: "#/components/parameters/older-than"
      responses:
        "200":
          description: statistics
          content:
            application/json:
              schema:
                type: array
                items:
                  type: object
                  properties:
                    Failing:
                      type: boolean
                    Count:
                      type: integer
                  required:
                    - Failing
                    - Count
        "401":
          $ref: "#/components/responses/error"
        "422":
          $ref: "#/components/responses/error"
        "500":
          $ref: "#/components/responses/error"
  /stats/exadata/patch-status:
    get:
      tags:
        - api-service
        - fe-user
        - read
      operationId: GetExadataPatchStatusStats
      summary: Get the statistics about the patch status of the exadata
      description: Get the statistics about the patch status of the exadata
      parameters:
        - $ref: "#/components/parameters/location"
        - $ref: "#/components/parameters/environment"
        - $ref: "#/components/parameters/older-than"
      responses:
        "200":
          description: statistics
          content:
            application/json:
              schema:
                type: array
                items:
                  type: object
                  properties:
                    Status:
                      type: boolean
                    Count:
                      type: integer
                  required:
                    - Status
                    - Count
        "401":
          $ref: "#/components/responses/error"
        "422":
          $ref: "#/components/responses/error"
        "500":
          $ref: "#/components/responses/error"
  /segment-advisors:
    get:
      parameters:
        - $ref: "#/components/parameters/search"
        - $ref: "#/components/parameters/sort-by"
        - $ref: "#/components/parameters/sort-desc"
        - $ref: "#/components/parameters/page"
        - $ref: "#/components/parameters/size"
        - $ref: "#/components/parameters/location"
        - $ref: "#/components/parameters/environment"
        - $ref: "#/components/parameters/older-than"

#########################################################################
### GLOBAL SECURITY
#########################################################################
security:
  - basicAuthApiService: []
  - tokenAuthApiService: []
